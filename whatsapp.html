<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Redireccionando a WhatsAppâ€¦</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>

<script>
  const params = new URLSearchParams(window.location.search);

  // =========================
  // TELÃ‰FONO (OBLIGATORIO)
  // =========================
  const phoneRaw = params.get("phone");

  if (!phoneRaw) {
    document.body.innerHTML = `
      <h2>Error</h2>
      <p>No se recibiÃ³ el telÃ©fono del socio.</p>
    `;
    throw new Error("Phone missing");
  }

  const phone = phoneRaw.replace(/\D/g, "");

  // =========================
  // TIPO DE MENSAJE
  // =========================
  const type = params.get("type") || "welcome";

  // =========================
  // DATOS OPCIONALES
  // =========================
  const nombre = params.get("nombre") || "";
  const plan   = params.get("plan") || "";
  const fecha  = params.get("fecha") || "";
  const link   = params.get("link") ? decodeURIComponent(params.get("link")) : "";

  let mensaje = "";

  // =========================
  // MENSAJES
  // =========================

  // BIENVENIDA SOCIO
  if (type === "welcome") {
    mensaje = `ğŸ‘‹ Hola ${nombre}!

ğŸ‰ Bienvenido/a a *Valencia Gym* ğŸ’ª
${plan ? `ğŸ· Plan: ${plan}` : ""}
${fecha ? `ğŸ“… Fecha de ingreso: ${fecha}` : ""}

${link ? `ğŸ”— Tu perfil de socio:\n${link}` : ""}

Â¡A entrenar! ğŸ”¥`;
  }

  // RECORDATORIO 5 DÃAS
  else if (type === "reminder") {
    mensaje = `ğŸ‘‹ Hola ${nombre}!

â° Te recordamos que faltan *5 dÃ­as* para el vencimiento de tu membresÃ­a.

ğŸ“… Vencimiento: ${fecha}

Cualquier cosa escribinos ğŸ’ª`;
  }

  // VENCIMIENTO
  else if (type === "due") {
    mensaje = `ğŸ‘‹ Hola ${nombre}!

ğŸ“Œ Tu membresÃ­a estÃ¡ vencida.
ğŸ“… Vencimiento: ${fecha}

ğŸ’³ Para regularizar:
Alias: *valencia.gym*
Banco: *Brubank*

O podÃ©s acercarte a recepciÃ³n.
Â¡Gracias! ğŸ’ª`;
  }

  // CUMPLEAÃ‘OS
  else if (type === "birthday") {
    mensaje = `ğŸ‚ Â¡Feliz cumpleaÃ±os ${nombre}! ğŸ‰

Desde *Valencia Gym* te deseamos un gran dÃ­a ğŸ’ª
Gracias por ser parte de la comunidad.

Â¡Te esperamos para entrenar! ğŸ”¥`;
  }

  // BIENVENIDA ENTRENADOR
  else if (type === "trainer") {
    mensaje = `ğŸ‘‹ Â¡Bienvenido/a a *Valencia Gym*! ğŸ’ª

Ya estÃ¡s dado/a de alta como entrenador/a.
Â¡Vamos con todo! ğŸ”¥`;
  }

  // FALLBACK
  else {
    mensaje = `ğŸ‘‹ Hola!

ğŸ‰ Te esperamos en *Valencia Gym* ğŸ’ª
Consultanos cuando quieras.
Â¡A entrenar! ğŸ”¥`;
  }

  // =========================
  // REDIRECCIÃ“N WHATSAPP
  // =========================
  const whatsappUrl =
    "https://api.whatsapp.com/send?phone=" +
    phone +
    "&text=" +
    encodeURIComponent(mensaje);

  window.location.replace(whatsappUrl);
</script>

</body>
</html>
